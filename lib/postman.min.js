(function(){var a,b,c,d,e,f,g,h,i,j,k,l;a={},j,g=function(a){return a.constructor===Array},i=function(a){return a.constructor===Function},h=function(a){return a.constructor===Date},b=function(b){return a[b]={subs:[],history:[]}},c=function(c,d){var e,f,h,i;a[c]||b(c),d||(d=[]),g(d)||(d=[d]),d={created:new Date,lastPublished:new Date,args:d},a[c].history.push(d),i=a[c].subs;for(f=0,h=i.length;f<h;f++)e=i[f],e.apply(this,d.args);return j},k=function(c,d,e){var f,g,h,i;a[c]||b(c),a[c].subs.push(d);if(!e){i=a[c].history;for(g=0,h=i.length;g<h;g++)f=i[g],d.apply(this,f.args),f.lastPublished=new Date}return j},l=function(c,d){var e,f;a[c]||b(c),d?(f=a[c].subs,e=f.indexOf(d),e>-1&&f.splice(0,e).concat(f.splice(e,f.length))):a[c].subs=[];return j},f=function(c,f){a[c]||b(c),f?(i(f)&&(a[c].history=e(f,a[c].history)),h(f)&&(a[c].history=d(f,a[c].history))):a[c].history=[];return j.deliver("dropMessage."+c)},e=function(a,b){return b.reduce(a)},d=function(a,b){return b.reduce(function(b){return b.created<a})},j={deliver:c,receive:k,dropMessages:f,retract:l},this.postman=j}).call(this)